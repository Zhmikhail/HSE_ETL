
Да, долго это было. Весь свой путь описывать не буду. 
Решил поднять 3 версию аирфлоу (Ваша вторая классическая - старая, не поддерживается более 2 лет). Да и знают ее уже все, только третья интересная. Но оказалось, они слишком уж сильно переворотили архитектуру. Если интересно, я тут вкратце ее опишу.
Пару фото я приложил в папку fotos, хотя по конфигу можно догадаться, что все верно и работает. Также я и с 18 постгресом все вкатил (у него оказалось 1 отличие, в пути папки с датой, теперь там есть номер версии. Зачем они так сделали?)



Пара слов об архитектуре:

Как все было раньше (2X):

скедулер (он каждую секунду проверяет есть ли новые даги и надо ли запустить старые) 
вебсервер (отрисовывает все, UI) 
воркеры (выполняют вычислительные задачи, генерят всякие подики в кубере чтобы они тоже выполняли)

Что изменилось:

НОВЫЙ КОМПОНЕНТ - DAG Processor. Именно на эту скотину я и потратил несколько часов.
По сути, Сделали декомпозицию монолита (скедулера), от которого могое зависело. 
В этот элемент вынесли функционал по чтению дагов, парсингу, взаимодействию с БД. 

скедулер (теперь только запускает даги (то есть нет записей в БД, только чтение))
аписервер (переназвали вебсервер, переписали на другой фреймворк)
воркеры (без высокоуровневых изменений)


Стоит ли обновляться? 

Мое мнение - нет. 
Конечно, если вы только выбираете версию нового аирфлоу, стоит брать новую. Но если у вас сотня дагов, которая уже рабоатет, куча токенов, переменных, что вы получите от пары десятков часов работы?

- При падении даг-процессора не упадет ЮИ (так как теперь даг-процессор не в скедулере)
(ну и что? ну попадает немного интерфейс, это же внутренний сервис, пусть иногда полежит)
- Можно скейлить даг-процессоры, UI
(если вы в такой большой конторе, мои советы вы даже не услышите. Вам некогда читать гитхабы, потому что надо поднимать один из кластеров, упавший в вашем мультикластере)



